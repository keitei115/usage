<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>トリプルフリーデータベース</title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}"/>
    <script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}"></script>
    <meta name="viewport" content="width=device-width">
</head>
<body class="bg-primary bg-opacity-10">
    <nav class="navbar navbar-expand-lg navbar-light bg-light justify-content-center mw-100">
        <div class="container-fluid">
            <a class="navbar-brand" href="/overview"><img border="0" src="/img/favicon.png">トリプルフリーデータベース</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="/ranking">使用率ランキング</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/form">パーティ投稿フォーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/overview">このサイトについて</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://twitter.com/TripleUsage">Twitter</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid text-nowrap">
        <div class="row">
            <div class="col-12">
                <form method="post">
                    <table>
                        <input type="date" name="before" value="2014-11-21" class="max-width-8em"> ~ <input type="date" name="after" id="d" th:value="${afterval}" class="max-width-8em">
                        <input type="submit" class="btn btn-secondary mx-0" value="で絞る" name = "date">
                    </table>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-xl-4 col-lg-4 col-md-6 col-xs-12 col-ms-12">
                <p class="bg-light border border-1" th:text="${before} + ' ~ ' + ${after} + 'の間の使用率'"></p>
                <p class="bg-light border border-1" th:text="${error}"></p>
            </div>
        </div>
        <div class="row flex-nowrap justify-content-start">
            <div class="col-xl-2 col-lg-2 col-md-2 col-xs-6 col-ms-6 max-width-40 max-height-ranking overflow-auto" id="pranking">
                <form method="post">
                    <table class="table table-hover bg-light border border-1">
                        <tr th:each="pokemon , stat : ${pokeranking}">
                            <td><button type="submit" name="name" th:value="${pokemon.name}"  class="btn btn-link width-100 height-100 left font-size-095" th:text="${stat.count} + ' : ' + ${pokemon.name}"></button></td>
                        </tr>
                    </table>
                </form>
            </div>
            <div class="col-xl-10 col-lg-10 col-md-10 col-ms-6 col-xs-6 font-size-09 max-height-ranking max-width-60 overflow-auto">
                <div class="row flex-sm-wrap flex-md-wrap justify-content-start m-1 px-0">
                    <div class="col-12 rounded bg-light shadow-sm m-1 mw-100 left">
                        <p class="m-1" th:text="${pokemonname} + ' - 使用率 : ' + ${#numbers.formatDecimal(pokemonusage, 1, 1)} + '%' "></p>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-ms-4 col-xs-4 rounded bg-light shadow-sm m-1 min-width-13em px-0">
                        <table class="m-1">
                            <td>わざ</td>
                            <tr th:each="move , stat : ${moveranking}">
                                <td th:text="${stat.count} + ':' + ${move.move} + ' ' + ${#numbers.formatDecimal(move.movetotal, 1, 1)} + '%' "></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-xs-4 col-ms-4 rounded bg-light shadow-sm m-1 min-width-13em px-0">
                        <table class="m-1">
                            <td>とくせい</td>
                            <tr th:each="ability , stat : ${abilityranking}">
                                <td th:text="${stat.count} + ':' + ${ability.ability} + ' ' + ${#numbers.formatDecimal(ability.abilitytotal, 1, 1)} + '%' "></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-xs-4 col-ms-4 col-xs-4 rounded bg-light shadow-sm m-1 min-width-13em px-0">
                        <table class="m-1">
                            <td>せいかく</td>
                            <tr th:each="nature , stat : ${natureranking}">
                                <td th:text="${stat.count} + ':' + ${nature.nature} + ' ' + ${#numbers.formatDecimal(nature.naturetotal, 1, 1)} + '%' "></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-xs-4 col-ms-4 col-xs-4 rounded bg-light shadow-sm m-1 min-width-13em px-0">
                        <table class="m-1">
                            <td>もちもの</td>
                            <tr th:each="item , stat : ${itemranking}">
                                <td th:text="${stat.count} + ':' + ${item.item} + ' ' + ${#numbers.formatDecimal(item.itemtotal, 1, 1)} + '%' "></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-xs-4 col-ms-4 col-xs-4 rounded bg-light shadow-sm m-1 min-width-13em px-0">
                        <table class="m-1">
                            同じパーティのポケモン
                            <tr th:each="samepokemon , stat : ${samepartyranking}">
                                <td th:text="${stat.count} + ':' + ${samepokemon.name} + ' ' + ${#numbers.formatDecimal(samepokemon.pokemontotal, 1, 1)} + '%' "></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var positionYrank;
        var positionYpage;
        var STORAGE_KEY_RANK = "scrollYrank";
        var STORAGE_KEY_PAGE = "scrollYpage";
        function checkOffsetRank(){
            positionYrank = pranking.scrollTop;
            localStorage.setItem(STORAGE_KEY_RANK, positionYrank);
        }
        function checkOffsetPage(){
            positionYpage = window.pageYOffset;
            localStorage.setItem(STORAGE_KEY_PAGE, positionYpage);
        }
        window.onload = function() {
            var today = new Date();
            today.setDate(today.getDate());
            var y = today.getFullYear();
            var m = ("0" + (today.getMonth() + 1)).slice(-2);
            var d = ("0" + today.getDate()).slice(-2);
            document.getElementById("d").value = y + "-" + m + "-" + d;
            positionYrank = localStorage.getItem(STORAGE_KEY_RANK);
            positionYpage = localStorage.getItem(STORAGE_KEY_PAGE);
            if(positionYrank !== null){pranking.scrollTo(0, positionYrank);}
            if(positionYpage !== null){scrollTo(0, positionYrank);}
            pranking.addEventListener("scroll", checkOffsetRank, false);
            window.addEventListener("scroll", checkOffsetPage, false);
        }
    </script>
    <style>
        .btn-link {
            color: rgb(0, 0, 0);
            text-decoration: none;
        }
        .right {
            text-align: right;
        }
        .left {
            text-align: left;
        }
        .max-width-40 {
            max-width: 40%;
        }
        .max-width-60 {
            max-width: 60%;
        }
        .font-size-09 {
            font-size: 0.9rem;
        }
        .font-size-095 {
            font-size: 0.95rem;
        }
        .max-height-ranking {
            max-height: calc(100vh - 154px);
        }
        .width-100 {
            width: 100%;
        }
        .height-100 {
            height: 100%;
        }
        .min-width-13em {
            min-width: 13em;
        }
        .max-width-8em {
            max-width: 8em;
        }
    </style>
</body>